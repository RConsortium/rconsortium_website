{
  "hash": "53b286305d629ff2ed7d87f3b92de7b3",
  "result": {
    "markdown": "---\ntitle: \"Statistical Inference for Persistence Diagrams\"\nunpublished: false\ndescription: \"{inphr} supports statistical inference for samples of persistence diagrams from persistent homology. It focuses on comparing populations of diagrams across different data types.\"\nauthor: \"Manon Simonot, Aymeric Stamm\"\nbibliography: references.bib\ncategories: [isc, software development]\nimage: \"toydata_preview.svg\"\nimage-alt: \"The {inphr} package includes three toy data sets.\"\ndate: \"01/28/2026\"\n---\n\n\n## Samples of persistence diagrams\n\nTopological data analysis (TDA) is a rapidly growing field that uses techniques\nfrom algebraic topology to analyze the shape and structure of data. At its core,\nTDA provides tools to understand the geometric and topological features of\ndatasets across multiple scales, with persistent homology (PH) being one of its\nfundamental techniques.\n\nThe documentation of the [{phutil}](https://tdaverse.github.io/phutil/) package provides an [overview of persistent homology](https://tdaverse.github.io/phutil/articles/validation-benchmark.html#definitions). For now, know that the result of\nthis procedure is a **persistence diagram**: a multiset (set with multiplicity)\nof points in the plane---usually the upper-half plane and most often the first\nquadrant. Persistence diagrams encode topological features of different\ndimensions, and a single diagram may encode features of one or all dimensions.\nBy **persistence data**, we mean a data structure that encodes diagrams of all\ndimensions, and possibly many diagrams coming from data sets of a common type.\n\nThe goal of [{inphr}](https://tdaverse.github.io/inphr/) is precisely to deal with comparing populations of persistence\ndiagrams coming from data sets of different types. This is classically called the\ntask of making inference on the basis of some collected data. Several R packages\ninclude inferential capabilities for persistence diagrams, including:\n\n-   [{TDA}](https://cran.r-project.org/package=TDA) which focuses on statistical\nanalysis of PH and density clustering by providing an R interface for the\nefficient algorithms of the C++ libraries\n[GUDHI](https://project.inria.fr/gudhi/software/),\n[Dionysus](https://www.mrzv.org/software/dionysus/) and\n[PHAT](https://bitbucket.org/phat-code/phat/). This package also implements\nmethods from @fasy2014confidence and @chazal2014stochastic for analyzing the\nstatistical significance of PH features.\n-   [{TDAstats}](https://cran.r-project.org/package=TDAstats) which provides a\ncomprehensive toolset for conducting TDA, specifically via the calculation of PH\nin a Vietoris-Rips complex [@wadhwa2018tdastats].\n-   [{TDAkit}](https://cran.r-project.org/package=TDAkit) which provides a\nvariety of algorithms to learn with PH of the data based on functional summaries\nfor clustering, hypothesis testing, and visualization\n[@wasserman2018topological].\n\nWhile these packages have made inference on persistence diagrams available to the\nR community, they only deal with inference on a single diagram using bootstrap\nresampling ({TDA}), or only offer inference to compare two diagrams by permutations\n({TDAstats}), or only compare functional summaries of groups of persistence diagrams\nto answer whether they come from the same underlying distribution ({TDAkit}).\n\nThe {inphr} package aims at going one step further by offering two sets of functions\nfor making inference:\n\n1. in the space of persistence diagrams (@sec-pd) for testing whether multiple collections of persistence diagrams come from the same underlying distribution;\n2. in functional spaces (@sec-functions) for localizing differences between multiple collections of persistence diagrams on the domain of some functional summary of them.\n\nThe following sections showcase these two kinds of inference.\n\n## Inference in the space of persistence diagrams {#sec-pd}\n\n### Distances between persistence diagrams\n\nTwo persistence diagrams $X$ and $Y$ are canonically compared using\n**Wasserstein distances**.\nThese are a family of metrics determined by a $q$-Minkowski distance on the plane\nand a $p$-norm on the distances between pairs of points matched via some $\\varphi : X \\to Y$:\n\n$$ \\left( \\sum_{x \\in X}{{\\lVert\nx-\\varphi(x) \\rVert_q}^p} \\right)^{1/p} $$\n\nThe distance $W_p^q(X,Y)$ is defined to be the infimum of this expression over all possible matchings.\nSee this\n[vignette](https://tdaverse.github.io/phutil/articles/validation-benchmark.html) from the {phutil} package\non distances for more detail, or @cohen2010lipschitz and @bubenik2023exact for\ndetailed treatments and stability results on these families of metrics.\n\nIn R, using the TDAverse, computation of the distance matrix is offered by the {phutil} package which is therefore a hard dependency of {inphr}.\n\nFunctions in {inphr} therefore accept:\n\n- either two objects of class 'persistence_set' produced by `phutil::as_persistence_set()` representing the two samples;\n- or an object of class 'persistence_set' produced by `phutil::as_persistence_set()` representing the contatenation of the two samples and a vector of two integers providing the sample sizes;\n- or an object of class 'dist' typically produced by `phutil::bottleneck_pairwise_distances()` or `phutil::wasserstein_pairwise_distances()` and a vector of two integers with the sample sizes.\n\n### Permutation inference\n\nThe package currently includes a function to compare two samples of persistence diagrams. The statistical method for doing that is described in @lovato2021multiscale. Subtantively, it performs inference in two steps:\n\n1. Pre-computation of the matrix $D$ of pairwise distances between persistence diagrams within and between samples;\n2. Permutations of the rows and columns of $D$ to approximate the distribution of one or more test statistics.\n\nLet $F_1$ be the probability distribution that generated the first sample and $F_2$ be the probability distribution that generated the second sample. Inference by permutations helps answering the following hypothesis test:\n\n$$\nH_0 : F_1 = F_2 \\quad \\mbox{v.s.} \\quad H_a : F_1 \\ne F_2.\n$$\n\nDifferently from classic parametric inference in which the null hypothesis typically assumes equality of the mean parameters or the variance parameters, it is critical that the null distribution be that the entire probability distributions be the same. This is essential because only then can we permute the labels of statistical units under the null hypothesis.\n\nHowever, depending on the test statistic that is used, the test only focuses on comparing some features of the probability distributions. For instance, if one uses the distance between the Frechet means as test statistic, the test will detect differences in means between the two ditributions but will be blind to differences in variances for example. For this reason, one can use multiple test statistics to make the test sensitive to differences in several moments of the distributions. This is called *non-parametric combination* and it is described in @pesarin2010permutation. \n\nThe {inphr} package uses this approach by relying on the [{flipr}](https://permaverse.github.io/flipr/) package which is the core package of the [permaverse](https://github.com/permaverse) collection of packages for permutation inference. Specifically, the dedicated function is `two_sample_diagram_test()` and, by default, it combines two test statistics based solely on inter-point distances that are defined in @lovato2021multiscale. One is sensitive to differences in means and the other to differences in variances. The user can actually choose one or more test statistics or even define his/her own. The result of the test is a p-value that helps in making the decision of whether to reject the null hypothesis. Optionally, one can ask the function to return the permutations that have been used (`keep_permutations = TRUE`) and the permutation distribution of the combined test statistic (`keep_null_distribution = TRUE`).\n\n### Toy examples\n\nThe {inphr} package includes the following three toy data sets.\n\n::: {.callout-note icon=\"false\"}\n## `trefoils1` and `trefoils2`\n\nTwo sets of 24 persistence diagrams each computed from noisy samples of trefoil knots. Each sample consists of 120 points sampled from a trefoil knot with Gaussian noise (sd = 0.05) added. Vietoris-Rips persistence was computed up to dimension 2 with maximum scale 6 using `TDA::ripsDiag()`. Generated with seed 28415.\n:::\n\n::: {.callout-note icon=\"false\"}\n## `archspirals`\n\nA set of 24 persistence diagrams computed from noisy samples of 2-armed Archimedean spirals. Each sample consists of 120 points sampled from an Archimedean spiral, embedded in 3D with a zero z-coordinate, then Gaussian noise (sd = 0.05) added. Vietoris-Rips persistence was computed up to dimension 2 with maximum scale 6 using `TDA::ripsDiag()`. Generated with seed 28415.\n:::\n\n@fig-toydata displays the first five persistence diagrams of each sample. The reader can appreciate that the first two lines corresponding to the same trefoil geometry shows similar diagrams while the last line corresponding to a 2-arm archspiral shows a different kind of diagram.\n\n![The first data point of each toy data set.](toydata_preview.svg){#fig-toydata}\n\nWe can therefore use `inphr::two_sample_diagram_test()` to compare:\n\n- `trefoils1` and `trefoils2` with expected output that there is not enough statistical evidence to reject the hypothesis that the two samples come from the same distribution;\n- `trefoils1` and `archspirals` with expected output that we can reject the hypothesis that the two samples come from the same distribution.\n\nThe following code performs the test between the two trefoil samples using only the first five statistical units:\n\n\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_296f7037c8c4cce86985f7139c4560d3'}\n\n```{.r .cell-code}\nwithr::with_seed(1234, {\n    two_sample_diagram_test(trefoils1[1:5], trefoils2[1:5])\n})\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9702381\n```\n:::\n:::\n\n\nAs expected, the test is not able to reject the null hypothesis. By default, the function uses `B = 1000` permutations, which makes the p-value resolution of $1/1001 \\approx 9.99 \\times 10^{-4}$. If we compare instead `trefoils1` against `archspirals`, again using only the first five statistical units, we get:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_b8b026c9560f2465af61d98cab413ab4'}\n\n```{.r .cell-code}\nwithr::with_seed(1234, {\n    two_sample_diagram_test(trefoils1[1:5], archspirals[1:5])\n})\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.002308242\n```\n:::\n:::\n\n\nAs expected, the test does detect the difference despite the small sample size.\n\n## Inference in the functional spaces {#sec-functions}\n\n### Functional representations of persistence homology\n\nThe {inphr} package relies on the [{TDAvec}](https://cran.r-project.org/package=TDAvec) package to compute functional representations of persistence diagrams. Currently, there are five truly functional representations (i.e. curves) of a given persisence diagram $D = (b_i, d_i)_{i=1}^N$ that {TDAvec} readily provides:\n\n- the Betti curve [@chazal2021introduction]:\n$$\n\\beta(t) = \\sum_{i=1}^N \\mathbb{1}_{[b_i, d_i)}(t).\n$$\n\n- the Euler characteristic curve [@richardson2014efficient]:\n$$\n\\chi(t) = \\sum_{k=0}^d (-1)^k \\beta_k(t),\n$$\nwhere $\\beta_0, \\beta_1, \\dots, \\beta_d$ are the Betti curves from the smaller persistence diagrams $D_0, D_1, \\dots, D_d$ restricted to only features of homology dimensions $0, 1, \\dots, d$ respectively.\n\n- the Normalized Life curve [@chung2022persistence]:\n$$\n\\mathrm{sl}(t) = \\sum_{i=1}^N \\frac{d_i - b_i}{L} \\mathbb{1}_{[b_i, d_i)}(t), \\quad \\mbox{where } L = \\sum_{i=1}^N (d_i - b_i).\n$$\n\n- the Silhouette curve [@chazal2014stochastic]:\n$$\n\\phi(t) = \\frac{\\sum_{i=1}^N (d_i - b_i) \\Lambda_i(t)}{L}, \\quad \\mbox{where } \\Lambda_i(t) = \\begin{cases}\nt - b_i & \\mbox{if } t \\in \\left[ b_i, \\frac{b_i + d_i}{2} \\right] \\\\\nd_i - t & \\mbox{if } t \\in \\left( \\frac{b_i + d_i}{2}, d_i \\right] \\\\\n0 & \\mbox{otherwise.}\n\\end{cases}\n$$\n\n- the Entropy Summary curve [@atienza2020stability]:\n$$\nS(t) = \\sum_{i=1}^N \\frac{d_i - b_i}{L} \\log_2 \\frac{d_i - b_i}{L} \\mathbb{1}_{[b_i, d_i]}(t).\n$$\n\n@fig-betti displays, as an example, the Betti curve representations of the 24 diagrams in each of the three toy data sets.\n\n![The Betti curves of all three toy data sets in {inphr}.](betti_curves.svg){#fig-betti}\n\n@fig-betti shows a clear difference between trefoil and archspiral geometry but overlapped curves between the two trefoil samples as expected.\n\n### Interval-wise testing for functional data\n\nThe {inphr} package relies on the [{fdatest}](https://permaverse.github.io/fdatest/) package which is also part of the permaverse to handle hypothesis testing on functional representations of persistence homology. Specifically, the {fdatest} package implements a method called *interval-wise testing* described in @pini2017interval which effectively performs domain selection by identifying the portion(s) of the domain of definition of the functional representation where there are statistically significant differences between samples. In the future, the package will also integrate other such domain selection methods described in @abramowicz2023domain.\n\nWhen using functional representations, we must choose the homology dimension which we want to work on. In {inphr}, we perform inference in functional spaces with the `two_sample_functional_test()`. For example, the following code uses the Betti curves for dimension $0$ to compare the two trefoil samples:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_4ae392e1a17f5f400aa28ddb17fdf32c'}\n\n```{.r .cell-code}\nout1 <- two_sample_functional_test(\n    trefoils1, trefoils2, \n    dimension = 0, \n    representation = \"betti\"\n)\n```\n:::\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_301505fc69fb2f009559e51bfbfe457a'}\n\n:::\n\n\nSimilarly, the following code uses the Betti curves for dimension $0$ to compare the first trefoil sample and the archspiral sample:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_5d63dc73ec34d429bf70d86867f47509'}\n\n```{.r .cell-code}\nout2 <- two_sample_functional_test(\n    trefoils1, archspirals, \n    dimension = 0, \n    representation = \"betti\"\n)\n```\n:::\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_aecc45743d28e77fe37cd57f6fac6045'}\n\n:::\n\n\nThe output of the `two_sample_functional_test()` function is a list with entries:\n\n- `xfd`: a numeric matrix of shape $N_1 \\times (P - 1)$ storing the chosen functional representation of the persistence diagrams in the 1st sample, where $N_1$ is the sample size and $P$ is the number of points on which the curves have been evaluated;\n- `yfd`: a numeric matrix of shape $N_2 \\times (P - 1)$ storing the chosen functional representation of the persistence diagrams in the 2st sample, where $N_2$ is the sample size and $P$ is the number of points on which the curves have been evaluated;\n- `scale_seq`: a numeric vector of shape $P$ storing the grid on which the curves have been evaluated;\n- `iwt`: an object of class 'ITP2' for which {fdatest} has dedicated `S3` implementations of methods such as `plot()`.\n\nHence we can display the results of the inferential procedures with the following code:\n\n\n\n\n::: {#fig-iwt .cell layout-ncol=\"2\" hash='index_cache/html/fig-iwt_788d748a96cc17ba4314b8bf8df08530'}\n\n```{.r .cell-code}\nplot(out1$iwt, main = \"Trefoil 1 vs Trefoil 2\")\nplot(out2$iwt, main = \"Trefoil vs 2-arm Archspiral\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-iwt-1.png){#fig-iwt-1 width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-iwt-2.png){#fig-iwt-2 width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-iwt-3.png){#fig-iwt-3 width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-iwt-4.png){#fig-iwt-4 width=672}\n:::\n\nVisual representation of the Interval-Wise Testing procedure.\n:::\n\n\n@fig-iwt displays the results of the IWT procedure. We can see the portions where statistically significant differences have been detected highlighted by grey areas. The left column shows the curves of the two samples in two different colors while the right column shows the adjusted p-value functions which provide strong control of the familywise error rate.\n\n## References",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}